!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@xmldom/xmldom")):"function"==typeof define&&define.amd?define(["exports","@xmldom/xmldom"],e):(t="undefined"!=typeof globalThis?globalThis:t||self,e(t.mpdParser={},t.window))}(this,function(t,e){"use strict";function n(t,e,n){return n={path:e,exports:{},require:function(t,e){return r(t,void 0===e||null===e?n.path:e)}},t(n,n.exports),n.exports}function r(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}function i(t){for(var e=ht(t),n=new Uint8Array(e.length),r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n}var a="0.22.0",o=function(t){return!!t&&"object"==typeof t},u=function At(){for(var t=arguments.length,e=new Array(t),n=0;t>n;n++)e[n]=arguments[n];return e.reduce(function(t,e){return"object"!=typeof e?t:(Object.keys(e).forEach(function(n){Array.isArray(t[n])&&Array.isArray(e[n])?t[n]=t[n].concat(e[n]):o(t[n])&&o(e[n])?t[n]=At(t[n],e[n]):t[n]=e[n]}),t)},{})},s=function(t){return Object.keys(t).map(function(e){return t[e]})},c=function(t,e){for(var n=[],r=t;e>r;r++)n.push(r);return n},d=function(t){return t.reduce(function(t,e){return t.concat(e)},[])},l=function(t){if(!t.length)return[];for(var e=[],n=0;n<t.length;n++)e.push(t[n]);return e},f=function(t,e){return t.reduce(function(t,n,r){return n[e]&&t.push(r),t},[])},m=function(t,e){for(var n=0;n<t.length;n++)if(e(t[n]))return n;return-1},p=function(t,e){return s(t.reduce(function(t,n){return n.forEach(function(n){t[e(n)]=n}),t},{}))},g={INVALID_NUMBER_OF_PERIOD:"INVALID_NUMBER_OF_PERIOD",DASH_EMPTY_MANIFEST:"DASH_EMPTY_MANIFEST",DASH_INVALID_XML:"DASH_INVALID_XML",NO_BASE_URL:"NO_BASE_URL",MISSING_SEGMENT_INFORMATION:"MISSING_SEGMENT_INFORMATION",SEGMENT_TIME_UNSPECIFIED:"SEGMENT_TIME_UNSPECIFIED",UNSUPPORTED_UTC_TIMING_SCHEME:"UNSUPPORTED_UTC_TIMING_SCHEME"},h=n(function(t,e){!function(e){var n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,i=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(t,e,n){if(n=n||{},t=t.trim(),e=e.trim(),!e){if(!n.alwaysNormalize)return t;var i=o.parseURL(t);if(!i)throw new Error("Error trying to parse base URL.");return i.path=o.normalizePath(i.path),o.buildURLFromParts(i)}var a=o.parseURL(e);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return n.alwaysNormalize?(a.path=o.normalizePath(a.path),o.buildURLFromParts(a)):e;var u=o.parseURL(t);if(!u)throw new Error("Error trying to parse base URL.");if(!u.netLoc&&u.path&&"/"!==u.path[0]){var s=r.exec(u.path);u.netLoc=s[1],u.path=s[2]}u.netLoc&&!u.path&&(u.path="/");var c={scheme:u.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(c.netLoc=u.netLoc,"/"!==a.path[0]))if(a.path){var d=u.path,l=d.substring(0,d.lastIndexOf("/")+1)+a.path;c.path=o.normalizePath(l)}else c.path=u.path,a.params||(c.params=u.params,a.query||(c.query=u.query));return null===c.path&&(c.path=n.alwaysNormalize?o.normalizePath(a.path):a.path),o.buildURLFromParts(c)},parseURL:function(t){var e=n.exec(t);return e?{scheme:e[1]||"",netLoc:e[2]||"",path:e[3]||"",params:e[4]||"",query:e[5]||"",fragment:e[6]||""}:null},normalizePath:function(t){for(t=t.split("").reverse().join("").replace(i,"");t.length!==(t=t.replace(a,"")).length;);return t.split("").reverse().join("")},buildURLFromParts:function(t){return t.scheme+t.netLoc+t.path+t.params+t.query+t.fragment}};t.exports=o}()}),v="http://example.com",b=function(t,e){if(/^[a-z]+:/i.test(e))return e;/^data:/.test(t)&&(t=window.location&&window.location.href||"");var n="function"==typeof window.URL,r=/^\/\//.test(t),i=!window.location&&!/\/\//i.test(t);if(n?t=new window.URL(t,window.location||v):/\/\//i.test(t)||(t=h.buildAbsoluteURL(window.location&&window.location.href||"",t)),n){var a=new URL(e,t);return i?a.href.slice(v.length):r?a.href.slice(a.protocol.length):a.href}return h.buildAbsoluteURL(t,e)},y=function(t){var e=t.baseUrl,n=void 0===e?"":e,r=t.source,i=void 0===r?"":r,a=t.range,o=void 0===a?"":a,u=t.indexRange,s=void 0===u?"":u,c={uri:i,resolvedUri:b(n||"",i)};if(o||s){var d=o?o:s,l=d.split("-"),f=window.BigInt?window.BigInt(l[0]):parseInt(l[0],10),m=window.BigInt?window.BigInt(l[1]):parseInt(l[1],10);f<Number.MAX_SAFE_INTEGER&&"bigint"==typeof f&&(f=Number(f)),m<Number.MAX_SAFE_INTEGER&&"bigint"==typeof m&&(m=Number(m));var p;p="bigint"==typeof m||"bigint"==typeof f?window.BigInt(m)-window.BigInt(f)+window.BigInt(1):m-f+1,"bigint"==typeof p&&p<Number.MAX_SAFE_INTEGER&&(p=Number(p)),c.byterange={length:p,offset:f}}return c},S=function(t){var e;return e="bigint"==typeof t.offset||"bigint"==typeof t.length?window.BigInt(t.offset)+window.BigInt(t.length)-window.BigInt(1):t.offset+t.length-1,t.offset+"-"+e},I=function(t){return t&&"number"!=typeof t&&(t=parseInt(t,10)),isNaN(t)?null:t},E={"static":function(t){var e=t.duration,n=t.timescale,r=void 0===n?1:n,i=t.sourceDuration,a=t.periodDuration,o=I(t.endNumber),u=e/r;return"number"==typeof o?{start:0,end:o}:"number"==typeof a?{start:0,end:a/u}:{start:0,end:i/u}},dynamic:function(t){var e=t.NOW,n=t.clientOffset,r=t.availabilityStartTime,i=t.timescale,a=void 0===i?1:i,o=t.duration,u=t.periodStart,s=void 0===u?0:u,c=t.minimumUpdatePeriod,d=void 0===c?0:c,l=t.timeShiftBufferDepth,f=void 0===l?1/0:l,m=I(t.endNumber),p=(e+n)/1e3,g=r+s,h=p+d,v=h-g,b=Math.ceil(v*a/o),y=Math.floor((p-g-f)*a/o),S=Math.floor((p-g)*a/o);return{start:Math.max(0,y),end:"number"==typeof m?m:Math.min(b,S)}}},w=function(t){return function(e){var n=t.duration,r=t.timescale,i=void 0===r?1:r,a=t.periodStart,o=t.startNumber,u=void 0===o?1:o;return{number:u+e,duration:n/i,timeline:a,time:e*n}}},U=function(t){var e=t.type,n=t.duration,r=t.timescale,i=void 0===r?1:r,a=t.periodDuration,o=t.sourceDuration,u=E[e](t),s=u.start,d=u.end,l=c(s,d).map(w(t));if("static"===e){var f=l.length-1,m="number"==typeof a?a:o;l[f].duration=m-n/i*f}return l},T=function(t){var e=t.baseUrl,n=t.initialization,r=void 0===n?{}:n,i=t.sourceDuration,a=t.indexRange,o=void 0===a?"":a,u=t.periodStart,s=t.presentationTime,c=t.number,d=void 0===c?0:c,l=t.duration;if(!e)throw new Error(g.NO_BASE_URL);var f=y({baseUrl:e,source:r.sourceURL,range:r.range}),m=y({baseUrl:e,source:e,indexRange:o});if(m.map=f,l){var p=U(t);p.length&&(m.duration=p[0].duration,m.timeline=p[0].timeline)}else i&&(m.duration=i,m.timeline=u);return m.presentationTime=s||u,m.number=d,[m]},D=function(t,e,n){var r,i=t.sidx.map?t.sidx.map:null,a=t.sidx.duration,o=t.timeline||0,u=t.sidx.byterange,s=u.offset+u.length,c=e.timescale,d=e.references.filter(function(t){return 1!==t.referenceType}),l=[],f=t.endList?"static":"dynamic",m=t.sidx.timeline,p=m,g=t.mediaSequence||0;r="bigint"==typeof e.firstOffset?window.BigInt(s)+e.firstOffset:s+e.firstOffset;for(var h=0;h<d.length;h++){var v=e.references[h],b=v.referencedSize,y=v.subsegmentDuration,S=void 0;S="bigint"==typeof r?r+window.BigInt(b)-window.BigInt(1):r+b-1;var I=r+"-"+S,E={baseUrl:n,timescale:c,timeline:o,periodStart:m,presentationTime:p,number:g,duration:y,sourceDuration:a,indexRange:I,type:f},w=T(E)[0];i&&(w.map=i),l.push(w),r+="bigint"==typeof r?window.BigInt(b):b,p+=y/c,g++}return t.segments=l,t},N=function(t,e,n){e.forEach(function(e){for(var r in t.mediaGroups[e])for(var i in t.mediaGroups[e][r]){var a=t.mediaGroups[e][r][i];n(a,e,r,i)}})},R=["AUDIO","SUBTITLES"],P=1/60,L=function(t){return p(t,function(t){var e=t.timeline;return e}).sort(function(t,e){return t.timeline>e.timeline?1:-1})},M=function(t,e){for(var n=0;n<t.length;n++)if(t[n].attributes.NAME===e)return t[n];return null},A=function(t){var e=[];return N(t,R,function(t,n,r,i){e=e.concat(t.playlists||[])}),e},O=function(t){var e=t.playlist,n=t.mediaSequence;e.mediaSequence=n,e.segments.forEach(function(t,n){t.number=e.mediaSequence+n})},_=function(t){var e=t.oldPlaylists,n=t.newPlaylists,r=t.timelineStarts;n.forEach(function(t){t.discontinuitySequence=m(r,function(e){var n=e.timeline;return n===t.timeline});var n=M(e,t.attributes.NAME);if(n&&!t.sidx){var i=t.segments[0],a=m(n.segments,function(t){return Math.abs(t.presentationTime-i.presentationTime)<P});if(-1===a)return O({playlist:t,mediaSequence:n.mediaSequence+n.segments.length}),t.segments[0].discontinuity=!0,t.discontinuityStarts.unshift(0),void((!n.segments.length&&t.timeline>n.timeline||n.segments.length&&t.timeline>n.segments[n.segments.length-1].timeline)&&t.discontinuitySequence--);var o=n.segments[a];o.discontinuity&&!i.discontinuity&&(i.discontinuity=!0,t.discontinuityStarts.unshift(0),t.discontinuitySequence--),O({playlist:t,mediaSequence:n.segments[a].number})}})},x=function(t){var e=t.oldManifest,n=t.newManifest,r=e.playlists.concat(A(e)),i=n.playlists.concat(A(n));return n.timelineStarts=L([e.timelineStarts,n.timelineStarts]),_({oldPlaylists:r,newPlaylists:i,timelineStarts:n.timelineStarts}),n},B=function(t){return t&&t.uri+"-"+S(t.byterange)},C=function(t){var e=s(t.reduce(function(t,e){var n=e.attributes.id+(e.attributes.lang||"")+(e.attributes.label||"");if(t[n]){if(e.segments){var r;e.segments[0]&&(e.segments[0].discontinuity=!0),(r=t[n].segments).push.apply(r,e.segments)}e.attributes.contentProtection&&(t[n].attributes.contentProtection=e.attributes.contentProtection)}else t[n]=e,t[n].attributes.timelineStarts=[];return t[n].attributes.timelineStarts.push({start:e.attributes.periodStart,timeline:e.attributes.periodStart}),t},{}));return e.map(function(t){return t.discontinuityStarts=f(t.segments||[],"discontinuity"),t})},q=function(t,e){var n=B(t.sidx),r=n&&e[n]&&e[n].sidx;return r&&D(t,r,t.sidx.resolvedUri),t},F=function(t,e){if(void 0===e&&(e={}),!Object.keys(e).length)return t;for(var n in t)t[n]=q(t[n],e);return t},G=function(t,e){var n,r=t.attributes,i=t.segments,a=t.sidx,o=t.mediaSequence,u=t.discontinuitySequence,s=t.discontinuityStarts,c={attributes:(n={NAME:r.id,BANDWIDTH:r.bandwidth,CODECS:r.codecs},n["PROGRAM-ID"]=1,n),uri:"",endList:"static"===r.type,timeline:r.periodStart,resolvedUri:"",targetDuration:r.duration,discontinuitySequence:u,discontinuityStarts:s,timelineStarts:r.timelineStarts,mediaSequence:o,segments:i};return r.contentProtection&&(c.contentProtection=r.contentProtection),a&&(c.sidx=a),e&&(c.attributes.AUDIO="audio",c.attributes.SUBTITLES="subs"),c},z=function(t){var e,n=t.attributes,r=t.segments,i=t.mediaSequence,a=t.discontinuityStarts,o=t.discontinuitySequence;"undefined"==typeof r&&(r=[{uri:n.baseUrl,timeline:n.periodStart,resolvedUri:n.baseUrl||"",duration:n.sourceDuration,number:0}],n.duration=n.sourceDuration);var u=(e={NAME:n.id,BANDWIDTH:n.bandwidth},e["PROGRAM-ID"]=1,e);return n.codecs&&(u.CODECS=n.codecs),{attributes:u,uri:"",endList:"static"===n.type,timeline:n.periodStart,resolvedUri:n.baseUrl||"",targetDuration:n.duration,timelineStarts:n.timelineStarts,discontinuityStarts:a,discontinuitySequence:o,mediaSequence:i,segments:r}},j=function(t,e,n){void 0===e&&(e={}),void 0===n&&(n=!1);var r,i=t.reduce(function(t,i){var a=i.attributes.role&&i.attributes.role.value||"",o=i.attributes.lang||"",u=i.attributes.label||"main";if(o&&!i.attributes.label){var s=a?" ("+a+")":"";u=""+i.attributes.lang+s}t[u]||(t[u]={language:o,autoselect:!0,"default":"main"===a,playlists:[],uri:""});var c=q(G(i,n),e);return t[u].playlists.push(c),"undefined"==typeof r&&"main"===a&&(r=i,r["default"]=!0),t},{});if(!r){var a=Object.keys(i)[0];i[a]["default"]=!0}return i},H=function(t,e){return void 0===e&&(e={}),t.reduce(function(t,n){var r=n.attributes.lang||"text";return t[r]||(t[r]={language:r,"default":!1,autoselect:!1,playlists:[],uri:""}),t[r].playlists.push(q(z(n),e)),t},{})},k=function(t){return t.reduce(function(t,e){return e?(e.forEach(function(e){var n=e.channel,r=e.language;t[r]={autoselect:!1,"default":!1,instreamId:n,language:r},e.hasOwnProperty("aspectRatio")&&(t[r].aspectRatio=e.aspectRatio),e.hasOwnProperty("easyReader")&&(t[r].easyReader=e.easyReader),e.hasOwnProperty("3D")&&(t[r]["3D"]=e["3D"])}),t):t},{})},$=function(t){var e,n=t.attributes,r=t.segments,i=t.sidx,a=t.discontinuityStarts,o={attributes:(e={NAME:n.id,AUDIO:"audio",SUBTITLES:"subs",RESOLUTION:{width:n.width,height:n.height},CODECS:n.codecs,BANDWIDTH:n.bandwidth},e["PROGRAM-ID"]=1,e),uri:"",endList:"static"===n.type,timeline:n.periodStart,resolvedUri:"",targetDuration:n.duration,discontinuityStarts:a,timelineStarts:n.timelineStarts,segments:r};return n.frameRate&&(o.attributes["FRAME-RATE"]=n.frameRate),n.contentProtection&&(o.contentProtection=n.contentProtection),i&&(o.sidx=i),o},V=function(t){var e=t.attributes;return"video/mp4"===e.mimeType||"video/webm"===e.mimeType||"video"===e.contentType},W=function(t){var e=t.attributes;return"audio/mp4"===e.mimeType||"audio/webm"===e.mimeType||"audio"===e.contentType},X=function(t){var e=t.attributes;return"text/vtt"===e.mimeType||"text"===e.contentType},Y=function(t,e){t.forEach(function(t){t.mediaSequence=0,t.discontinuitySequence=m(e,function(e){var n=e.timeline;return n===t.timeline}),t.segments&&t.segments.forEach(function(t,e){t.number=e})})},Z=function(t){return t?Object.keys(t).reduce(function(e,n){var r=t[n];return e.concat(r.playlists)},[]):[]},K=function(t){var e,n=t.dashPlaylists,r=t.locations,i=t.sidxMapping,a=void 0===i?{}:i,o=t.previousManifest;if(!n.length)return{};var u=n[0].attributes,s=u.sourceDuration,c=u.type,d=u.suggestedPresentationDelay,l=u.minimumUpdatePeriod,f=C(n.filter(V)).map($),m=C(n.filter(W)),p=C(n.filter(X)),g=n.map(function(t){return t.attributes.captionServices}).filter(Boolean),h={allowCache:!0,discontinuityStarts:[],segments:[],endList:!0,mediaGroups:(e={AUDIO:{},VIDEO:{}},e["CLOSED-CAPTIONS"]={},e.SUBTITLES={},e),uri:"",duration:s,playlists:F(f,a)};l>=0&&(h.minimumUpdatePeriod=1e3*l),r&&(h.locations=r),"dynamic"===c&&(h.suggestedPresentationDelay=d);var v=0===h.playlists.length,b=m.length?j(m,a,v):null,y=p.length?H(p,a):null,S=f.concat(Z(b),Z(y)),I=S.map(function(t){var e=t.timelineStarts;return e});return h.timelineStarts=L(I),Y(S,h.timelineStarts),b&&(h.mediaGroups.AUDIO.audio=b),y&&(h.mediaGroups.SUBTITLES.subs=y),g.length&&(h.mediaGroups["CLOSED-CAPTIONS"].cc=k(g)),o?x({oldManifest:o,newManifest:h}):h},J=function(t,e,n){var r=t.NOW,i=t.clientOffset,a=t.availabilityStartTime,o=t.timescale,u=void 0===o?1:o,s=t.periodStart,c=void 0===s?0:s,d=t.minimumUpdatePeriod,l=void 0===d?0:d,f=(r+i)/1e3,m=a+c,p=f+l,g=p-m;return Math.ceil((g*u-e)/n)},Q=function(t,e){for(var n=t.type,r=t.minimumUpdatePeriod,i=void 0===r?0:r,a=t.media,o=void 0===a?"":a,u=t.sourceDuration,s=t.timescale,c=void 0===s?1:s,d=t.startNumber,l=void 0===d?1:d,f=t.periodStart,m=[],p=-1,g=0;g<e.length;g++){var h=e[g],v=h.d,b=h.r||0,y=h.t||0;0>p&&(p=y),y&&y>p&&(p=y);var S=void 0;if(0>b){var I=g+1;S=I===e.length?"dynamic"===n&&i>0&&o.indexOf("$Number$")>0?J(t,p,v):(u*c-p)/v:(e[I].t-p)/v}else S=b+1;for(var E=l+m.length+S,w=l+m.length;E>w;)m.push({number:w,duration:v/c,time:p,timeline:f}),p+=v,w++}return m},tt=/\$([A-z]*)(?:(%0)([0-9]+)d)?\$/g,et=function(t){return function(e,n,r,i){if("$$"===e)return"$";if("undefined"==typeof t[n])return e;var a=""+t[n];return"RepresentationID"===n?a:(i=r?parseInt(i,10):1,a.length>=i?a:""+new Array(i-a.length+1).join("0")+a)}},nt=function(t,e){return t.replace(tt,et(e))},rt=function(t,e){return t.duration||e?t.duration?U(t):Q(t,e):[{number:t.startNumber||1,duration:t.sourceDuration,time:0,timeline:t.periodStart}]},it=function(t,e){var n={RepresentationID:t.id,Bandwidth:t.bandwidth||0},r=t.initialization,i=void 0===r?{sourceURL:"",range:""}:r,a=y({baseUrl:t.baseUrl,source:nt(i.sourceURL,n),range:i.range}),o=rt(t,e);return o.map(function(e){n.Number=e.number,n.Time=e.time;var r=nt(t.media||"",n),i=t.timescale||1,o=t.presentationTimeOffset||0,u=t.periodStart+(e.time-o)/i,s={uri:r,timeline:e.timeline,duration:e.duration,resolvedUri:b(t.baseUrl||"",r),map:a,number:e.number,presentationTime:u};return s})},at=function(t,e){var n=t.baseUrl,r=t.initialization,i=void 0===r?{}:r,a=y({baseUrl:n,source:i.sourceURL,range:i.range}),o=y({baseUrl:n,source:e.media,range:e.mediaRange});return o.map=a,o},ot=function(t,e){var n=t.duration,r=t.segmentUrls,i=void 0===r?[]:r,a=t.periodStart;if(!n&&!e||n&&e)throw new Error(g.SEGMENT_TIME_UNSPECIFIED);var o,u=i.map(function(e){return at(t,e)});n&&(o=U(t)),e&&(o=Q(t,e));var s=o.map(function(e,n){if(u[n]){var r=u[n],i=t.timescale||1,o=t.presentationTimeOffset||0;return r.timeline=e.timeline,r.duration=e.duration,r.number=e.number,r.presentationTime=a+(e.time-o)/i,r}}).filter(function(t){return t});return s},ut=function(t){var e,n,r=t.attributes,i=t.segmentInfo;i.template?(n=it,e=u(r,i.template)):i.base?(n=T,e=u(r,i.base)):i.list&&(n=ot,e=u(r,i.list));var a={attributes:r};if(!n)return a;var o=n(e,i.segmentTimeline);if(e.duration){var s=e,c=s.duration,d=s.timescale,l=void 0===d?1:d;e.duration=c/l}else o.length?e.duration=o.reduce(function(t,e){return Math.max(t,Math.ceil(e.duration))},0):e.duration=0;return a.attributes=e,a.segments=o,i.base&&e.indexRange&&(a.sidx=o[0],a.segments=[]),a},st=function(t){return t.map(ut)},ct=function(t,e){return l(t.childNodes).filter(function(t){var n=t.tagName;return n===e})},dt=function(t){return t.textContent.trim()},lt=function(t){return parseFloat(t.split("/").reduce(function(t,e){return t/e}))},ft=function(t){var e=31536e3,n=2592e3,r=86400,i=3600,a=60,o=/P(?:(\d*)Y)?(?:(\d*)M)?(?:(\d*)D)?(?:T(?:(\d*)H)?(?:(\d*)M)?(?:([\d.]*)S)?)?/,u=o.exec(t);if(!u)return 0;var s=u.slice(1),c=s[0],d=s[1],l=s[2],f=s[3],m=s[4],p=s[5];return parseFloat(c||0)*e+parseFloat(d||0)*n+parseFloat(l||0)*r+parseFloat(f||0)*i+parseFloat(m||0)*a+parseFloat(p||0)},mt=function(t){var e=/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/;return e.test(t)&&(t+="Z"),Date.parse(t)},pt={mediaPresentationDuration:function(t){return ft(t)},availabilityStartTime:function(t){return mt(t)/1e3},minimumUpdatePeriod:function(t){return ft(t)},suggestedPresentationDelay:function(t){return ft(t)},type:function(t){return t},timeShiftBufferDepth:function(t){return ft(t)},start:function(t){return ft(t)},width:function(t){return parseInt(t,10)},height:function(t){return parseInt(t,10)},bandwidth:function(t){return parseInt(t,10)},frameRate:function(t){return lt(t)},startNumber:function(t){return parseInt(t,10)},timescale:function(t){return parseInt(t,10)},presentationTimeOffset:function(t){return parseInt(t,10)},duration:function(t){var e=parseInt(t,10);return isNaN(e)?ft(t):e},d:function(t){return parseInt(t,10)},t:function(t){return parseInt(t,10)},r:function(t){return parseInt(t,10)},DEFAULT:function(t){return t}},gt=function(t){return t&&t.attributes?l(t.attributes).reduce(function(t,e){var n=pt[e.name]||pt.DEFAULT;return t[e.name]=n(e.value),t},{}):{}},ht=function(t){return window.atob?window.atob(t):Buffer.from(t,"base64").toString("binary")},vt={"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b":"org.w3.clearkey","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":"com.widevine.alpha","urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb":"com.adobe.primetime"},bt=function(t,e){return e.length?d(t.map(function(t){return e.map(function(e){return b(t,dt(e))})})):t},yt=function(t){var e=ct(t,"SegmentTemplate")[0],n=ct(t,"SegmentList")[0],r=n&&ct(n,"SegmentURL").map(function(t){return u({tag:"SegmentURL"},gt(t))}),i=ct(t,"SegmentBase")[0],a=n||e,o=a&&ct(a,"SegmentTimeline")[0],s=n||i||e,c=s&&ct(s,"Initialization")[0],d=e&&gt(e);d&&c?d.initialization=c&&gt(c):d&&d.initialization&&(d.initialization={sourceURL:d.initialization});var l={template:d,segmentTimeline:o&&ct(o,"S").map(function(t){return gt(t)}),list:n&&u(gt(n),{segmentUrls:r,initialization:gt(c)}),base:i&&u(gt(i),{initialization:gt(c)})};return Object.keys(l).forEach(function(t){l[t]||delete l[t]}),l},St=function(t,e,n){return function(r){var i=ct(r,"BaseURL"),a=bt(e,i),o=u(t,gt(r)),s=yt(r);return a.map(function(t){return{segmentInfo:u(n,s),attributes:u(o,{baseUrl:t})}})}},It=function(t){return t.reduce(function(t,e){var n=gt(e);n.schemeIdUri&&(n.schemeIdUri=n.schemeIdUri.toLowerCase());var r=vt[n.schemeIdUri];if(r){t[r]={attributes:n};var a=ct(e,"cenc:pssh")[0];if(a){var o=dt(a);t[r].pssh=o&&i(o)}}return t},{})},Et=function(t){if("urn:scte:dash:cc:cea-608:2015"===t.schemeIdUri){var e="string"!=typeof t.value?[]:t.value.split(";");return e.map(function(t){var e,n;if(n=t,/^CC\d=/.test(t)){var r=t.split("=");e=r[0],n=r[1]}else/^CC\d$/.test(t)&&(e=t);return{channel:e,language:n}})}if("urn:scte:dash:cc:cea-708:2015"===t.schemeIdUri){var n="string"!=typeof t.value?[]:t.value.split(";");return n.map(function(t){var e={channel:void 0,language:void 0,aspectRatio:1,easyReader:0,"3D":0};if(/=/.test(t)){var n=t.split("="),r=n[0],i=n[1],a=void 0===i?"":i;e.channel=r,e.language=t,a.split(",").forEach(function(t){var n=t.split(":"),r=n[0],i=n[1];"lang"===r?e.language=i:"er"===r?e.easyReader=Number(i):"war"===r?e.aspectRatio=Number(i):"3D"===r&&(e["3D"]=Number(i))})}else e.language=t;return e.channel&&(e.channel="SERVICE"+e.channel),e})}},wt=function(t,e,n){return function(r){var i=gt(r),a=bt(e,ct(r,"BaseURL")),o=ct(r,"Role")[0],s={role:gt(o)},c=u(t,i,s),l=ct(r,"Accessibility")[0],f=Et(gt(l));f&&(c=u(c,{captionServices:f}));var m=ct(r,"Label")[0];if(m&&m.childNodes.length){var p=m.childNodes[0].nodeValue.trim();c=u(c,{label:p})}var g=It(ct(r,"ContentProtection"));Object.keys(g).length&&(c=u(c,{contentProtection:g}));var h=yt(r),v=ct(r,"Representation"),b=u(n,h);return d(v.map(St(c,a,b)))}},Ut=function(t,e){return function(n,r){var i=bt(e,ct(n.node,"BaseURL")),a=u(t,{periodStart:n.attributes.start});"number"==typeof n.attributes.duration&&(a.periodDuration=n.attributes.duration);var o=ct(n.node,"AdaptationSet"),s=yt(n.node);return d(o.map(wt(a,i,s)))}},Tt=function(t){var e=t.attributes,n=t.priorPeriodAttributes,r=t.mpdType;return"number"==typeof e.start?e.start:n&&"number"==typeof n.start&&"number"==typeof n.duration?n.start+n.duration:n||"static"!==r?null:0},Dt=function(t,e){void 0===e&&(e={});var n=e,r=n.manifestUri,i=void 0===r?"":r,a=n.NOW,o=void 0===a?Date.now():a,u=n.clientOffset,s=void 0===u?0:u,c=ct(t,"Period");if(!c.length)throw new Error(g.INVALID_NUMBER_OF_PERIOD);var l=ct(t,"Location"),f=gt(t),m=bt([i],ct(t,"BaseURL"));f.type=f.type||"static",f.sourceDuration=f.mediaPresentationDuration||0,f.NOW=o,f.clientOffset=s,l.length&&(f.locations=l.map(dt));var p=[];return c.forEach(function(t,e){var n=gt(t),r=p[e-1];n.start=Tt({attributes:n,priorPeriodAttributes:r?r.attributes:null,mpdType:f.type}),p.push({node:t,attributes:n})}),{locations:f.locations,representationInfo:d(p.map(Ut(f,m)))}},Nt=function(t){if(""===t)throw new Error(g.DASH_EMPTY_MANIFEST);var n,r,i=new e.DOMParser;try{n=i.parseFromString(t,"application/xml"),r=n&&"MPD"===n.documentElement.tagName?n.documentElement:null}catch(a){}if(!r||r&&r.getElementsByTagName("parsererror").length>0)throw new Error(g.DASH_INVALID_XML);return r},Rt=function(t){var e=ct(t,"UTCTiming")[0];if(!e)return null;var n=gt(e);switch(n.schemeIdUri){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":n.method="HEAD";break;case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":n.method="GET";break;case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":n.method="DIRECT",n.value=Date.parse(n.value);break;case"urn:mpeg:dash:utc:http-ntp:2014":case"urn:mpeg:dash:utc:ntp:2014":case"urn:mpeg:dash:utc:sntp:2014":default:throw new Error(g.UNSUPPORTED_UTC_TIMING_SCHEME)}return n},Pt=a,Lt=function(t,e){void 0===e&&(e={});var n=Dt(Nt(t),e),r=st(n.representationInfo);return K({dashPlaylists:r,locations:n.locations,sidxMapping:e.sidxMapping,previousManifest:e.previousManifest})},Mt=function(t){return Rt(Nt(t))};t.VERSION=Pt,t.addSidxSegmentsToPlaylist=D,t.generateSidxKey=B,t.inheritAttributes=Dt,t.parse=Lt,t.parseUTCTiming=Mt,t.stringToMpdXml=Nt,t.toM3u8=K,t.toPlaylists=st,Object.defineProperty(t,"__esModule",{value:!0})});